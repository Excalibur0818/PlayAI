<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>在线翻译 | PlayAI</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        'sans': ['Inter', 'system-ui', '-apple-system', 'sans-serif'],
                    },
                    colors: {
                        'apple-gray': '#f5f5f7',
                        'apple-dark': '#1d1d1f',
                        'apple-light': '#fbfbfd',
                        'apple-blue': '#0071e3',
                        'apple-blue-hover': '#0077ed',
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.6s ease-out',
                        'fade-in-up': 'fadeInUp 0.8s ease-out',
                    },
                    keyframes: {
                        fadeIn: {
                            '0%': { opacity: '0' },
                            '100%': { opacity: '1' },
                        },
                        fadeInUp: {
                            '0%': { opacity: '0', transform: 'translateY(30px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' },
                        }
                    }
                }
            }
        }
    </script>
    <style>
        * {
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        .glass-effect {
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
        }
        .hero-gradient {
            background: linear-gradient(180deg, #ffffff 0%, #f5f5f7 100%);
        }
        .card-hover {
            transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }
        .card-hover:hover {
            transform: translateY(-8px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }
        .btn-apple {
            transition: all 0.3s ease;
        }
        .btn-apple:hover {
            transform: scale(1.02);
        }
        .nav-link {
            position: relative;
        }
        .nav-link::after {
            content: '';
            position: absolute;
            bottom: -4px;
            left: 0;
            width: 0;
            height: 2px;
            background: #1d1d1f;
            transition: width 0.3s ease;
        }
        .nav-link:hover::after {
            width: 100%;
        }
    </style>
</head>
<body class="bg-apple-gray text-apple-dark font-sans">
    <!-- 导航栏 -->
    <nav class="fixed top-0 left-0 right-0 z-50 glass-effect border-b border-gray-200/50">
        <div class="max-w-6xl mx-auto px-6 py-4 flex justify-between items-center">
            <div class="flex items-center gap-3">
                <a href="index.html" class="flex items-center gap-3">
                    <div class="w-10 h-10 bg-apple-dark rounded-xl flex items-center justify-center">
                        <i class="fas fa-robot text-white text-lg"></i>
                    </div>
                    <span class="font-semibold text-lg tracking-tight">PlayAI</span>
                </a>
            </div>
            <div class="hidden md:flex gap-8">
                <a href="index.html" class="nav-link text-sm text-gray-600 hover:text-apple-dark">首页</a>
                <a href="index.html#tools" class="nav-link text-sm text-gray-600 hover:text-apple-dark">工具</a>
                <a href="docs/" class="nav-link text-sm text-gray-600 hover:text-apple-dark">知识库</a>
            </div>
            <button class="md:hidden text-xl">
                <i class="fas fa-bars"></i>
            </button>
        </div>
    </nav>

    <!-- 主内容 -->
    <div class="pt-24 pb-16 px-4 min-h-screen hero-gradient">
        <div class="max-w-2xl mx-auto">
            <!-- 头部 -->
            <header class="text-center mb-8 animate-fade-in-up">
                <div class="inline-flex items-center gap-2 bg-blue-100 px-4 py-2 rounded-full mb-6">
                    <span class="w-2 h-2 bg-blue-500 rounded-full animate-pulse"></span>
                    <span class="text-sm text-blue-700">百度翻译 API</span>
                </div>
                <h1 class="text-4xl md:text-5xl font-semibold mb-4">
                    在线翻译
                </h1>
                <p class="text-gray-500">支持多行文本批量翻译，实时显示结果，一键复制</p>
            </header>

            <!-- 设置面板 -->
            <div class="bg-white rounded-2xl p-6 mb-6 shadow-sm">
                <h2 class="font-semibold mb-4 flex items-center gap-2">
                    <i class="fas fa-cog text-gray-400"></i>
                    API 配置
                </h2>

                <!-- AppID 输入 -->
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-600 mb-3">百度翻译 AppID</label>
                    <input type="text" id="appid-input" placeholder="请输入百度翻译 AppID" class="w-full px-4 py-3 rounded-xl border border-gray-200 bg-white text-gray-700 focus:outline-none focus:border-apple-blue transition-colors">
                </div>

                <!-- Key 输入 -->
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-600 mb-3">百度翻译 Key</label>
                    <div class="relative">
                        <input type="password" id="key-input" placeholder="请输入百度翻译 Key" class="w-full px-4 py-3 rounded-xl border border-gray-200 bg-white text-gray-700 focus:outline-none focus:border-apple-blue transition-colors">
                        <button type="button" onclick="toggleKeyVisibility()" class="absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600">
                            <i class="fas fa-eye" id="eye-icon"></i>
                        </button>
                    </div>
                    <p class="mt-2 text-xs text-gray-500">API 配置仅保存在本地浏览器中，不会上传到服务器</p>
                </div>

                <!-- 代理地址配置 -->
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-600 mb-3">代理地址（可选）</label>
                    <input type="text" id="proxy-input" placeholder="如部署了代理服务可填入，无则留空" class="w-full px-4 py-3 rounded-xl border border-gray-200 bg-white text-gray-700 focus:outline-none focus:border-apple-blue transition-colors">
                    <p class="mt-2 text-xs text-gray-500">如遇跨域错误，请部署 api/translate.js 到 Vercel 并填入地址</p>
                </div>

                <!-- API 配置说明 -->
                <div class="mt-4 p-4 bg-blue-50 rounded-xl">
                    <p class="text-sm text-blue-700">
                        <i class="fas fa-info-circle mr-2"></i>
                        如何获取 API？访问 <a href="https://api.fanyi.baidu.com/" target="_blank" class="underline">百度翻译开放平台</a> 注册并创建应用获取 AppID 和 Key
                    </p>
                </div>
            </div>

            <!-- 输入面板 -->
            <div class="bg-white rounded-2xl p-6 mb-6 shadow-sm">
                <h2 class="font-semibold mb-4 flex items-center gap-2">
                    <i class="fas fa-edit text-gray-400"></i>
                    翻译内容
                </h2>

                <!-- 多行文本输入 -->
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-600 mb-3">输入要翻译的文本（每行一条）</label>
                    <textarea id="source-text" rows="6" placeholder="请输入要翻译的文本，每行一条&#10;例如：&#10;你好&#10;世界&#10;Hello World" class="w-full px-4 py-3 rounded-xl border border-gray-200 bg-white text-gray-700 focus:outline-none focus:border-apple-blue transition-colors resize-none"></textarea>
                    <p class="mt-2 text-xs text-gray-500">支持批量翻译，每行文本将单独翻译</p>
                </div>

                <!-- 目标语言选择 -->
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-600 mb-3">目标语言</label>
                    <select id="target-lang" class="w-full px-4 py-3 rounded-xl border border-gray-200 bg-white text-gray-700 focus:outline-none focus:border-apple-blue transition-colors">
                        <option value="en">英语 (English)</option>
                        <option value="ja">日语 (日本語)</option>
                        <option value="ko">韩语 (한국어)</option>
                        <option value="fr">法语 (Français)</option>
                        <option value="de">德语 (Deutsch)</option>
                        <option value="ru">俄语 (Русский)</option>
                        <option value="es">西班牙语 (Español)</option>
                        <option value="pt">葡萄牙语 (Português)</option>
                        <option value="it">意大利语 (Italiano)</option>
                        <option value="ar">阿拉伯语 (العربية)</option>
                        <option value="vi">越南语 (Tiếng Việt)</option>
                        <option value="th">泰语 (ไทย)</option>
                        <option value="zh">中文 (简体)</option>
                    </select>
                </div>

                <!-- 翻译按钮 -->
                <button onclick="doTranslate()" id="translate-btn" class="w-full btn-apple bg-apple-dark text-white px-8 py-4 rounded-xl text-lg font-medium hover:bg-gray-800">
                    <i class="fas fa-language mr-2"></i>开始翻译
                </button>
            </div>

            <!-- 加载状态 -->
            <div id="loading" class="hidden text-center py-8">
                <div class="inline-flex flex-col items-center">
                    <div class="w-12 h-12 border-4 border-gray-200 border-t-apple-dark rounded-full animate-spin mb-4"></div>
                    <p class="text-gray-500">翻译中...</p>
                </div>
            </div>

            <!-- 结果展示 -->
            <div id="result" class="hidden">
                <h3 class="font-semibold mb-4 flex items-center gap-2">
                    <i class="fas fa-list text-gray-400"></i>
                    翻译结果
                </h3>
                <div id="result-list" class="space-y-4"></div>

                <!-- 重新翻译按钮 -->
                <div class="mt-6">
                    <button onclick="clearResults()" class="w-full btn-apple bg-gray-100 text-gray-700 px-6 py-3 rounded-xl font-medium hover:bg-gray-200">
                        <i class="fas fa-redo mr-2"></i>清空结果
                    </button>
                </div>
            </div>

            <!-- 说明 -->
            <div class="mt-8 text-center text-sm text-gray-500">
                <p>支持多种语言互译，每行文本单独翻译</p>
            </div>
        </div>
    </div>

    <!-- 页脚 -->
    <footer class="bg-apple-dark text-white py-8">
        <div class="max-w-6xl mx-auto px-6 flex flex-col md:flex-row items-center justify-between gap-4">
            <div class="flex items-center gap-2 text-sm text-gray-400">
                <i class="fas fa-heart text-red-500"></i>
                <span>Made with AI</span>
            </div>
            <div class="text-sm text-gray-500">&copy; 2026 PlayAI. All rights reserved.</div>
        </div>
    </footer>

    <script>
        // MD5 实现
        function md5(string) {
            function md5_RotateLeft(lValue, iShiftBits) {
                return (lValue << iShiftBits) | (lValue >>> (32 - iShiftBits));
            }
            function md5_AddUnsigned(lX, lY) {
                var lX4, lY4, lX8, lY8, lResult;
                lX8 = (lX & 0x80000000);
                lY8 = (lY & 0x80000000);
                lX4 = (lX & 0x40000000);
                lY4 = (lY & 0x40000000);
                lResult = (lX & 0x3FFFFFFF) + (lY & 0x3FFFFFFF);
                if (lX4 & lY4) {
                    return (lResult ^ 0x80000000 ^ lX8 ^ lY8);
                }
                if (lX4 | lY4) {
                    if (lResult & 0x40000000) {
                        return (lResult ^ 0xC0000000 ^ lX8 ^ lY8);
                    } else {
                        return (lResult ^ 0x40000000 ^ lX8 ^ lY8);
                    }
                } else {
                    return (lResult ^ lX8 ^ lY8);
                }
            }
            function md5_F(x, y, z) { return (x & y) | ((~x) & z); }
            function md5_G(x, y, z) { return (x & z) | (y & (~z)); }
            function md5_H(x, y, z) { return (x ^ y ^ z); }
            function md5_I(x, y, z) { return (y ^ (x | (~z))); }
            function md5_FF(a, b, c, d, x, s, ac) {
                a = md5_AddUnsigned(a, md5_AddUnsigned(md5_AddUnsigned(md5_F(b, c, d), x), ac));
                return md5_AddUnsigned(md5_RotateLeft(a, s), b);
            }
            function md5_GG(a, b, c, d, x, s, ac) {
                a = md5_AddUnsigned(a, md5_AddUnsigned(md5_AddUnsigned(md5_G(b, c, d), x), ac));
                return md5_AddUnsigned(md5_RotateLeft(a, s), b);
            }
            function md5_HH(a, b, c, d, x, s, ac) {
                a = md5_AddUnsigned(a, md5_AddUnsigned(md5_AddUnsigned(md5_H(b, c, d), x), ac));
                return md5_AddUnsigned(md5_RotateLeft(a, s), b);
            }
            function md5_II(a, b, c, d, x, s, ac) {
                a = md5_AddUnsigned(a, md5_AddUnsigned(md5_AddUnsigned(md5_I(b, c, d), x), ac));
                return md5_AddUnsigned(md5_RotateLeft(a, s), b);
            }
            function md5_ConvertToWordArray(string) {
                var lWordCount;
                var lMessageLength = string.length;
                var lNumberOfWords_temp1 = lMessageLength + 8;
                var lNumberOfWords_temp2 = (lNumberOfWords_temp1 - (lNumberOfWords_temp1 % 64)) / 64;
                var lNumberOfWords = (lNumberOfWords_temp2 + 1) * 16;
                var lWordArray = Array(lNumberOfWords - 1);
                var lBytePosition = 0;
                var lByteCount = 0;
                while (lByteCount < lMessageLength) {
                    lWordCount = (lByteCount - (lByteCount % 4)) / 4;
                    lBytePosition = (lByteCount % 4) * 8;
                    lWordArray[lWordCount] = (lWordArray[lWordCount] | (string.charCodeAt(lByteCount) << lBytePosition));
                    lByteCount++;
                }
                lWordCount = (lByteCount - (lByteCount % 4)) / 4;
                lBytePosition = (lByteCount % 4) * 8;
                lWordArray[lWordCount] = lWordArray[lWordCount] | (0x80 << lBytePosition);
                lWordArray[lNumberOfWords - 2] = lMessageLength << 3;
                lWordArray[lNumberOfWords - 1] = lMessageLength >>> 29;
                return lWordArray;
            }
            function md5_WordToHex(lValue) {
                var WordToHexValue = "", WordToHexValue_temp = "", lByte, lCount;
                for (lCount = 0; lCount <= 3; lCount++) {
                    lByte = (lValue >>> (lCount * 8)) & 255;
                    WordToHexValue_temp = "0" + lByte.toString(16);
                    WordToHexValue = WordToHexValue + WordToHexValue_temp.substr(WordToHexValue_temp.length - 2, 2);
                }
                return WordToHexValue;
            }
            var x = Array();
            var k, AA, BB, CC, DD, a, b, c, d;
            var S11 = 7, S12 = 12, S13 = 17, S14 = 22;
            var S21 = 5, S22 = 9, S23 = 14, S24 = 20;
            var S31 = 4, S32 = 11, S33 = 16, S34 = 23;
            var S41 = 6, S42 = 10, S43 = 15, S44 = 21;
            x = md5_ConvertToWordArray(string);
            a = 0x67452301; b = 0xEFCDAB89; c = 0x98BADCFE; d = 0x10325476;
            for (k = 0; k < x.length; k += 16) {
                AA = a; BB = b; CC = c; DD = d;
                a = md5_FF(a, b, c, d, x[k + 0], S11, 0xD76AA478);
                d = md5_FF(d, a, b, c, x[k + 1], S12, 0xE8C7B756);
                c = md5_FF(c, d, a, b, x[k + 2], S13, 0x242070DB);
                b = md5_FF(b, c, d, a, x[k + 3], S14, 0xC1BDCEEE);
                a = md5_FF(a, b, c, d, x[k + 4], S11, 0xF57C0FAF);
                d = md5_FF(d, a, b, c, x[k + 5], S12, 0x4787C62A);
                c = md5_FF(c, d, a, b, x[k + 6], S13, 0xA8304613);
                b = md5_FF(b, c, d, a, x[k + 7], S14, 0xFD469501);
                a = md5_FF(a, b, c, d, x[k + 8], S11, 0x698098D8);
                d = md5_FF(d, a, b, c, x[k + 9], S12, 0x8B44F7AF);
                c = md5_FF(c, d, a, b, x[k + 10], S13, 0xFFFF5BB1);
                b = md5_FF(b, c, d, a, x[k + 11], S14, 0x895CD7BE);
                a = md5_FF(a, b, c, d, x[k + 12], S11, 0x6B901122);
                d = md5_FF(d, a, b, c, x[k + 13], S12, 0xFD987193);
                c = md5_FF(c, d, a, b, x[k + 14], S13, 0xA679438E);
                b = md5_FF(b, c, d, a, x[k + 15], S14, 0x49B40821);
                a = md5_GG(a, b, c, d, x[k + 1], S21, 0xF61E2562);
                d = md5_GG(d, a, b, c, x[k + 6], S22, 0xC040B340);
                c = md5_GG(c, d, a, b, x[k + 11], S23, 0x265E5A51);
                b = md5_GG(b, c, d, a, x[k + 0], S24, 0xE9B6C7AA);
                a = md5_GG(a, b, c, d, x[k + 5], S21, 0xD62F105D);
                d = md5_GG(d, a, b, c, x[k + 10], S22, 0x2441453);
                c = md5_GG(c, d, a, b, x[k + 15], S23, 0xD8A1E681);
                b = md5_GG(b, c, d, a, x[k + 4], S24, 0xE7D3FBC8);
                a = md5_GG(a, b, c, d, x[k + 9], S21, 0x21E1CDE6);
                d = md5_GG(d, a, b, c, x[k + 14], S22, 0xC33707D6);
                c = md5_GG(c, d, a, b, x[k + 3], S23, 0xF4D50D87);
                b = md5_GG(b, c, d, a, x[k + 8], S24, 0x455A14ED);
                a = md5_GG(a, b, c, d, x[k + 13], S21, 0xA9E3E905);
                d = md5_GG(d, a, b, c, x[k + 2], S22, 0xFCEFA3F8);
                c = md5_GG(c, d, a, b, x[k + 7], S23, 0x676F02D9);
                b = md5_GG(b, c, d, a, x[k + 12], S24, 0x8D2A4C8A);
                a = md5_HH(a, b, c, d, x[k + 5], S31, 0xFFFA3942);
                d = md5_HH(d, a, b, c, x[k + 8], S32, 0x8771F681);
                c = md5_HH(c, d, a, b, x[k + 11], S33, 0x6D9D6122);
                b = md5_HH(b, c, d, a, x[k + 14], S34, 0xFDE5380C);
                a = md5_HH(a, b, c, d, x[k + 1], S31, 0xA4BEEA44);
                d = md5_HH(d, a, b, c, x[k + 4], S32, 0x4BDECFA9);
                c = md5_HH(c, d, a, b, x[k + 7], S33, 0xF6BB4B60);
                b = md5_HH(b, c, d, a, x[k + 10], S34, 0xBEBFBC70);
                a = md5_HH(a, b, c, d, x[k + 13], S31, 0x289B7EC6);
                d = md5_HH(d, a, b, c, x[k + 0], S32, 0xEAA127FA);
                c = md5_HH(c, d, a, b, x[k + 3], S33, 0xD4EF3085);
                b = md5_HH(b, c, d, a, x[k + 6], S34, 0x4881D05);
                a = md5_HH(a, b, c, d, x[k + 9], S31, 0xD9D4D039);
                d = md5_HH(d, a, b, c, x[k + 12], S32, 0xE6DB99E5);
                c = md5_HH(c, d, a, b, x[k + 15], S33, 0x1FA27CF8);
                b = md5_HH(b, c, d, a, x[k + 2], S34, 0xC4AC5665);
                a = md5_II(a, b, c, d, x[k + 0], S41, 0xF4292244);
                d = md5_II(d, a, b, c, x[k + 7], S42, 0x432AFF97);
                c = md5_II(c, d, a, b, x[k + 14], S43, 0xAB9423A7);
                b = md5_II(b, c, d, a, x[k + 5], S44, 0xFC93A039);
                a = md5_II(a, b, c, d, x[k + 12], S41, 0x655B59C3);
                d = md5_II(d, a, b, c, x[k + 3], S42, 0x8F0CCC92);
                c = md5_II(c, d, a, b, x[k + 10], S43, 0xFFEFF47D);
                b = md5_II(b, c, d, a, x[k + 1], S44, 0x85845DD1);
                a = md5_II(a, b, c, d, x[k + 8], S41, 0x6FA87E4F);
                d = md5_II(d, a, b, c, x[k + 15], S42, 0xFE2CE6E0);
                c = md5_II(c, d, a, b, x[k + 6], S43, 0xA3014314);
                b = md5_II(b, c, d, a, x[k + 13], S44, 0x4E0811A1);
                a = md5_II(a, b, c, d, x[k + 4], S41, 0xF7537E82);
                d = md5_II(d, a, b, c, x[k + 11], S42, 0xBD3AF235);
                c = md5_II(c, d, a, b, x[k + 2], S43, 0x2AD7D2BB);
                b = md5_II(b, c, d, a, x[k + 9], S44, 0xEB86D391);
                a = md5_AddUnsigned(a, AA);
                b = md5_AddUnsigned(b, BB);
                c = md5_AddUnsigned(c, CC);
                d = md5_AddUnsigned(d, DD);
            }
            return (md5_WordToHex(a) + md5_WordToHex(b) + md5_WordToHex(c) + md5_WordToHex(d)).toLowerCase();
        }

        // 保存配置
        function saveConfig() {
            const appid = document.getElementById('appid-input').value.trim();
            const key = document.getElementById('key-input').value.trim();
            const proxy = document.getElementById('proxy-input').value.trim();
            if (appid) localStorage.setItem('playai_baidu_appid', appid);
            if (key) localStorage.setItem('playai_baidu_key', key);
            if (proxy) localStorage.setItem('playai_baidu_proxy', proxy);
        }

        // 加载配置
        function loadConfig() {
            const appid = localStorage.getItem('playai_baidu_appid');
            const key = localStorage.getItem('playai_baidu_key');
            const proxy = localStorage.getItem('playai_baidu_proxy');
            if (appid) document.getElementById('appid-input').value = appid;
            if (key) document.getElementById('key-input').value = key;
            if (proxy) document.getElementById('proxy-input').value = proxy;
        }

        // 切换 Key 显示/隐藏
        function toggleKeyVisibility() {
            const input = document.getElementById('key-input');
            const icon = document.getElementById('eye-icon');
            if (input.type === 'password') {
                input.type = 'text';
                icon.className = 'fas fa-eye-slash';
            } else {
                input.type = 'password';
                icon.className = 'fas fa-eye';
            }
        }

        // 翻译
        async function doTranslate() {
            const appid = document.getElementById('appid-input').value.trim();
            const key = document.getElementById('key-input').value.trim();
            const sourceText = document.getElementById('source-text').value.trim();
            const targetLang = document.getElementById('target-lang').value;

            // 验证输入
            if (!appid) {
                alert('请输入百度翻译 AppID');
                return;
            }
            if (!key) {
                alert('请输入百度翻译 Key');
                return;
            }
            if (!sourceText) {
                alert('请输入要翻译的文本');
                return;
            }

            // 保存配置
            saveConfig();

            // 按行分割文本
            const lines = sourceText.split('\n').filter(line => line.trim());
            if (lines.length === 0) {
                alert('请输入有效的翻译文本');
                return;
            }

            // 显示加载状态
            document.getElementById('loading').classList.remove('hidden');
            document.getElementById('result').classList.add('hidden');
            document.getElementById('translate-btn').disabled = true;

            const resultList = document.getElementById('result-list');
            resultList.innerHTML = '';

            try {
                // 逐行翻译
                for (let i = 0; i < lines.length; i++) {
                    const text = lines[i].trim();
                    if (!text) continue;

                    const result = await translateLine(text, 'auto', targetLang, appid, key);

                    // 创建结果卡片
                    const card = document.createElement('div');
                    card.className = 'bg-white rounded-xl p-4 shadow-sm';
                    card.innerHTML = `
                        <div class="flex items-start gap-3">
                            <div class="flex-1">
                                <div class="text-xs text-gray-400 mb-1">原文</div>
                                <div class="text-sm text-gray-600 mb-3">${escapeHtml(text)}</div>
                                <div class="text-xs text-gray-400 mb-1">译文</div>
                                <div class="text-gray-800 result-text">${escapeHtml(result)}</div>
                            </div>
                            <button onclick="copyResult(this)" class="flex-shrink-0 p-2 text-gray-400 hover:text-apple-blue transition-colors" title="复制译文">
                                <i class="fas fa-copy"></i>
                            </button>
                        </div>
                    `;
                    resultList.appendChild(card);
                }

                document.getElementById('result').classList.remove('hidden');
                document.getElementById('result').scrollIntoView({ behavior: 'smooth' });
            } catch (error) {
                console.error('翻译失败:', error);
                // 检测是否是 CORS 错误
                if (error.message === 'Failed to fetch' || error.message.includes('NetworkError')) {
                    alert('翻译失败: 跨域错误\n\n解决方案：\n1. 安装浏览器 CORS 扩展（如 Allow CORS）\n2. 或部署 api/translate.js 到 Vercel 并在"代理地址"中填入地址');
                } else {
                    alert('翻译失败: ' + error.message);
                }
            } finally {
                document.getElementById('loading').classList.add('hidden');
                document.getElementById('translate-btn').disabled = false;
            }
        }

        // 翻译单行
        async function translateLine(text, from, to, appid, key) {
            const salt = Math.random().toString(36).substr(2, 10);
            // 签名用原始文本（不需要编码）
            const sign = md5(appid + text + salt + key);
            // 请求中的 q 需要 URL 编码
            const encodedText = encodeURIComponent(text);

            // 获取用户配置的代理地址
            const proxyUrl = document.getElementById('proxy-input').value.trim();

            if (proxyUrl) {
                // 使用代理服务
                const response = await fetch(proxyUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ q: encodedText, from, to, appid, salt, sign })
                });
                const data = await response.json();
                if (data.error) {
                    throw new Error(data.error);
                }
                return data.trans_result[0].dst;
            } else {
                // 直接调用（需要 CORS 扩展或代理）
                const response = await fetch('https://api.fanyi.baidu.com/api/trans/vip/translate', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded'
                    },
                    body: `q=${encodedText}&from=${from}&to=${to}&appid=${appid}&salt=${salt}&sign=${sign}`
                });

                const data = await response.json();

                if (data.error_code) {
                    throw new Error(data.error_msg || '翻译失败');
                }

                return data.trans_result[0].dst;
            }
        }

        // HTML 转义
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // 复制结果
        function copyResult(btn) {
            const text = btn.closest('.bg-white').querySelector('.result-text').textContent;
            navigator.clipboard.writeText(text).then(() => {
                const icon = btn.querySelector('i');
                icon.className = 'fas fa-check text-green-500';
                setTimeout(() => {
                    icon.className = 'fas fa-copy';
                }, 2000);
            });
        }

        // 清空结果
        function clearResults() {
            document.getElementById('result').classList.add('hidden');
            document.getElementById('source-text').value = '';
        }

        // 初始化
        loadConfig();
    </script>
</body>
</html>
